apiVersion: v1
kind: Pod
metadata:
  name: spark-pi
  namespace: compute
  labels:
    app: spark-pi
spec:
  serviceAccountName: spark
  restartPolicy: Never
  volumes:
    - name: spark-logs
      hostPath:
        path: /data/spark/logs        # ğŸ‘ˆ Ä‘Æ°á»ng dáº«n tháº­t trÃªn node host
        type: DirectoryOrCreate
  containers:
    - name: spark
      image: apache/spark:3.5.3
      imagePullPolicy: IfNotPresent
      volumeMounts:
        - mountPath: /opt/spark/work-dir/logs
          name: spark-logs
      command:
        - /bin/bash
        - -c
        - |
          mkdir -p /opt/spark/work-dir/logs && \
          /opt/spark/bin/spark-submit \
            --master k8s://https://kubernetes.default.svc \
            --deploy-mode cluster \
            --name spark-pi \
            --class org.apache.spark.examples.SparkPi \
            --conf spark.kubernetes.namespace=compute \
            --conf spark.kubernetes.authenticate.driver.serviceAccountName=spark \
            --conf spark.kubernetes.container.image=apache/spark:3.5.3 \
            --conf spark.eventLog.enabled=true \
            --conf spark.eventLog.dir=file:///opt/spark/work-dir/logs \
            --conf spark.kubernetes.driver.pod.name=spark-pi-$(date +%s) \
            --packages org.apache.hadoop:hadoop-aws:3.3.4,com.amazonaws:aws-java-sdk-bundle:1.12.262\
            local:///opt/spark/examples/jars/spark-examples_2.12-3.5.3.jar \
            1000
      ports:
        - name: ui
          containerPort: 4040