apiVersion: batch/v1
kind: Job
metadata:
  name: airflow-init
  namespace: orchestration
spec:
  template:
    spec:
      restartPolicy: OnFailure
      containers:
        - name: airflow-init
          image: ghostwood/airflow-mbs:2.7.3
          envFrom:
            - secretRef:
                name: airflow-secrets
          command:
            - bash
            - -c
            - |
              airflow db init && \
              airflow users create \
                --username admin \
                --firstname Admin \
                --lastname User \
                --role Admin \
                --email admin@example.com \
                --password admin
